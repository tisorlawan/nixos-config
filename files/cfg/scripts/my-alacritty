#!/usr/bin/env bash

set -euo pipefail

WRITE_CONFIG_ONLY=0
if [ "${1:-}" = "--write-config-only" ]; then
  WRITE_CONFIG_ONLY=1
  shift
fi

SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
COLOR_MODE="$($SCRIPT_DIR/color-mode)"
COLOR_MODE=dark

DIR="$HOME/.config/alacritty"
mkdir -p "$DIR"
THEME_FILE="$DIR/theme.toml"
TMP_THEME="$(mktemp "$DIR/theme.toml.XXXXXX")"

cat >"$TMP_THEME" <<EOF
# AUTOGENERATED by scripts/my-alacritty
$(if [ "$COLOR_MODE" = "light" ]; then
  cat <<'LIGHT'
[colors.primary]
background = "#ffffff"
foreground = "#1f1f1d"

[colors.cursor]
text = "#fdfdfc"
cursor = "#3f3f3b"

[colors.selection]
text = "#1f1f1d"
background = "#dfe7f3"

[colors.normal]
black = "#4a4a46"
red = "#b53a2f"
green = "#2f7d32"
yellow = "#8f5f00"
blue = "#1f5f9a"
magenta = "#7a3ea3"
cyan = "#0f7a78"
white = "#f1f1ef"

[colors.bright]
black = "#6a6a66"
red = "#d3483d"
green = "#3f9442"
yellow = "#a86f00"
blue = "#2d73b5"
magenta = "#9550bf"
cyan = "#1a9391"
white = "#ffffff"

[window]
opacity = 1.0
LIGHT
else
  cat <<'DARK'
[colors.primary]
#background = "#181820"
background = "#131313"
foreground = "#c8c8d0"

[colors.cursor]
text = "#181820"
cursor = "#a8a8b3"

[colors.selection]
text = "#c8c8d0"
background = "#2a2a37"

[window]
opacity = 0.92
DARK
fi)
EOF

mv "$TMP_THEME" "$THEME_FILE"

if [ "$WRITE_CONFIG_ONLY" -eq 1 ]; then
  exit 0
fi

exec alacritty "$@"
