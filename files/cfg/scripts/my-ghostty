#!/usr/bin/env bash

# Dynamic Ghostty config generator and launcher
# This script reads COLOR env var or ~/.color file, generates config, and launches ghostty

# Check COLOR environment variable first, then fall back to ~/.color file
COLOR_MODE="$COLOR"

if [ -z "$COLOR_MODE" ] && [ -f ~/.color ]; then
    COLOR_MODE=$(cat ~/.color 2>/dev/null | tr -d '[:space:]')
fi

# Default to dark if no preference found
if [ "$COLOR_MODE" != "light" ]; then
    COLOR_MODE="dark"
fi
echo $COLOR_MODE

# Ensure config directory exists

DIR="$HOME/.config/ghostty"
mkdir -p "$DIR"

# Generate and write config
cat > $DIR/config << EOF
# AUTOGENERATED CONFIG by ~/.script/my-ghostty

$(if [ "$COLOR_MODE" = "light" ]; then
    echo 'theme = "BlulocoLight"'
else
    echo 'theme = "catppuccin-mocha"'
    echo 'background = 181820'
fi)

# background-opacity = 0.5
# background = 181818
font-family = "BlexMono Nerd Font Propo SemiBold"
font-size = 14
adjust-font-baseline = 1
adjust-cell-height = 0
adjust-underline-position = 1

window-decoration = "none"
window-padding-balance = true
window-padding-x = 0
window-padding-y = 0
maximize = true

class = com.ghostty.tiso
x11-instance-name = ghost
window-padding-color = background
gtk-single-instance = false
adw-toolbar-style = flat
gtk-titlebar-hide-when-maximized = true

cursor-invert-fg-bg = true
clipboard-paste-protection = false

confirm-close-surface = false
app-notifications = no-clipboard-copy

keybind = all:alt+one=unbind
keybind = all:alt+two=unbind
keybind = all:alt+three=unbind
keybind = all:alt+four=unbind

# vim: ft=config
EOF

exec ghostty
